---
import { type CollectionEntry, getCollection } from "astro:content";
import Hero from "@/components/Hero.astro";
import PostCard from "@/components/blog/PostCard.astro";
import Note from "@/components/note/Note.astro";
import { getAllPosts } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";
export const prerender = true;

// Posts
const MAX_POSTS = 10;
const allPosts = await getAllPosts();
const allPostsByDate = allPosts
	.sort(collectionDateSort)
	.slice(0, MAX_POSTS) as CollectionEntry<"post">[];

// Notes
const MAX_NOTES = 0;
const allNotes = await getCollection("note");
const latestNotes = allNotes.sort(collectionDateSort).slice(0, MAX_NOTES);
---

<PageLayout meta={{ title: "主页" }}>
	<!-- Hero 区域 -->
	<Hero />

	<!-- 简洁的跳转箭头 -->
	<div class="relative my-12 flex justify-center">
		<a
			href="/posts/"
			class="group inline-flex items-center justify-center rounded-full p-3 transition-all hover:bg-gray-100 dark:hover:bg-gray-800"
			aria-label="查看所有文章"
		>
			<svg
				class="h-8 w-8 text-gray-400 transition-all group-hover:translate-y-1 group-hover:text-accent"
				fill="none"
				stroke="currentColor"
				viewBox="0 0 24 24"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					stroke-width="2"
					d="M19 14l-7 7m0 0l-7-7m7 7V3"
				/>
			</svg>
		</a>
	</div>

	<!-- 文章列表区域 -->
	<section aria-label="Blog post list" class="animate-fadeInUp">
		<div class="mb-8">
			<h2 class="mb-2 text-2xl font-bold text-textColor">
				最新文章
			</h2>
			<p class="text-sm text-gray-600 dark:text-gray-400">探索我的最新想法和发现</p>
		</div>

		<!-- 卡片网格布局 -->
		<div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
			{
				allPostsByDate.map((post) => (
					<PostCard post={post} />
				))
			}
		</div>

		<!-- 查看更多按钮 -->
		<div class="mt-8 text-center">
			<a
				href="/posts/"
				class="inline-flex items-center gap-2 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-700 transition-colors hover:bg-gray-50 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700"
			>
				查看所有文章
				<svg
					class="h-4 w-4"
					fill="none"
					stroke="currentColor"
					viewBox="0 0 24 24"
				>
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="2"
						d="M9 5l7 7-7 7"
					/>
				</svg>
			</a>
		</div>
	</section>

	<!-- 笔记区域（如果有的话） -->
	{
		latestNotes.length > 0 && (
			<>
				<!-- 装饰性分隔线 -->
				<div class="relative my-16">
					<div class="absolute inset-0 flex items-center">
						<div class="w-full border-t border-gray-200 dark:border-gray-700"></div>
					</div>
					<div class="relative flex justify-center">
						<span class="bg-bgColor px-4 text-sm text-gray-500 dark:text-gray-400">
							更多内容
						</span>
					</div>
				</div>

				<section class="animate-fadeInUp">
					<div class="mb-8">
						<h2 class="mb-2 text-2xl font-bold text-textColor">
							笔记
						</h2>
						<p class="text-sm text-gray-600 dark:text-gray-400">快速记录的想法和灵感</p>
					</div>
					<ul class="space-y-4" role="list">
						{latestNotes.map((note) => (
							<li>
								<Note note={note} as="h3" isPreview />
							</li>
						))}
					</ul>
				</section>
			</>
		)
	}
</PageLayout>